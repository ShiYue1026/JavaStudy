# åŸºç¡€

## Javaä¸­æœ‰å“ªäº›å¸¸è§çš„é›†åˆæ¡†æ¶

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šJavaé›†åˆä¸»è¦å…³ç³»](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/gailan-01.png)

Javaé›†åˆæ¡†æ¶å¯ä»¥åˆ†ä¸ºä¸¤å¤§æ”¯çº¿ï¼š

**1. Collection**ï¼šä¸»è¦ç”±Listã€Setã€Queueç»„æˆ

- Listï¼šä»£è¡¨æœ‰åºã€å¯é‡å¤çš„é›†åˆï¼Œå¦‚ArrayListå’ŒLinkedList
- Setï¼šä»£è¡¨æ— åºã€ä¸å¯é‡å¤çš„é›†åˆï¼Œå¦‚HashSetå’ŒTreeSet
- Queueï¼šä»£è¡¨é˜Ÿåˆ—ï¼Œå¦‚åŒç«¯é˜Ÿåˆ—ArrayDequeä»¥åŠä¼˜å…ˆçº§é˜Ÿåˆ—PriorityQueue

**2. Map**ï¼šä»£è¡¨é”®å€¼å¯¹çš„é›†åˆ

- ä»£è¡¨é”®å€¼å¯¹çš„é›†åˆï¼Œå¦‚HashMap



## ç®€å•ä»‹ç»ä¸€ä¸‹é˜Ÿåˆ—Queue

Javaä¸­çš„é˜Ÿåˆ—ä¸»è¦é€šè¿‡Queueæ¥å£å’ŒBlockingQueueä¸¤ä¸ªæ¥å£æ¥å®ç°ã€‚

**PriorityQueue**

- PriorityQueue æ˜¯ä¸€ä¸ªåŸºäºä¼˜å…ˆçº§å †çš„æ— ç•Œé˜Ÿåˆ—ï¼Œå®ƒçš„å…ƒç´ æŒ‰ç…§è‡ªç„¶é¡ºåºæ’åºæˆ–è€… Comparator è¿›è¡Œæ’åºã€‚

  ![æè±ªï¼šä¼˜å…ˆçº§é˜Ÿåˆ—](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/PriorityQueue-8dca2f55-a7c7-49e1-95a5-df1a34f2aef5.png)

**ArrayDeque**

- ArrayDequeæ˜¯ä¸€ä¸ªåŸºäºæ•°ç»„çš„åŒç«¯é˜Ÿåˆ—ï¼Œå¯ä»¥åœ¨ä¸¤ç«¯æ’å…¥å’Œåˆ é™¤å…ƒç´ 

  ![æè±ªï¼šåŒç«¯é˜Ÿåˆ—](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/arraydeque-1e7086a3-3d31-4553-aa16-5eaf2193649e.png)

**LinkedList**

- LinkedListæ—¢å¯ä»¥å½“ä½œListä½¿ç”¨ä¹Ÿå¯ä»¥å½“ä½œQueueä½¿ç”¨

  ![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/list-war-2-02.png)

## ç”¨è¿‡å“ªäº›é›†åˆç±»ï¼Œå®ƒä»¬çš„ä¼˜åŠ£æ˜¯ä»€ä¹ˆ

**1. ArrayList**ï¼š

- ArrayList å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªåŠ¨æ€æ•°ç»„ï¼Œå®ƒå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€æ‰©å®¹
- ä¼˜ç‚¹æ˜¯è®¿é—®é€Ÿåº¦å¿«ï¼Œå¯ä»¥**é€šè¿‡ç´¢å¼•ç›´æ¥æŸ¥åˆ°å…ƒç´ **
- ç¼ºç‚¹æ˜¯**æ’å…¥å’Œåˆ é™¤å…ƒç´ å¯èƒ½éœ€è¦ç§»åŠ¨å…ƒç´ **ï¼Œæ•ˆç‡å°±ä¼šé™ä½

**2. LinkedList**

- LinkedListæ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œé€‚åˆé¢‘ç¹çš„æ’å…¥å’Œåˆ é™¤æ“ä½œ
- ä¼˜ç‚¹æ˜¯**æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶å€™åªéœ€è¦æ”¹å˜èŠ‚ç‚¹çš„å‰åæŒ‡é’ˆ**
- ç¼ºç‚¹æ˜¯**è®¿é—®å…ƒç´ æ—¶éœ€è¦éå†é“¾è¡¨**

**3. HashMap**

- HashMapæ˜¯ä¸€ä¸ªåŸºäºå“ˆå¸Œè¡¨çš„é”®å€¼å¯¹é›†åˆ
- ä¼˜ç‚¹æ˜¯**æ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾å…ƒç´ çš„é€Ÿåº¦éƒ½å¾ˆå¿«**
- ç¼ºç‚¹æ˜¯**ä¸ä¿ç•™é”®å€¼å¯¹çš„æ’å…¥é¡ºåº**

**4. LinkedHashMap**ï¼š

- LinkedHashMapåœ¨HashMapçš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€ä¸ª**åŒå‘é“¾è¡¨**æ¥**ä¿æŒé”®å€¼å¯¹çš„æ’å…¥é¡ºåº**



## å“ªäº›é›†åˆæ˜¯çº¿ç¨‹å®‰å…¨çš„

åƒ Vectorã€Hashtableã€ConcurrentHashMapã€CopyOnWriteArrayListã€ConcurrentLinkedQueueã€ArrayBlockingQueueã€LinkedBlockingQueue è¿™äº›éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„



# List

## ArrayListå’ŒLinkedListæœ‰ä»€ä¹ˆåŒºåˆ«

ArrayList æ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼ŒLinkedList æ˜¯åŸºäºé“¾è¡¨å®ç°çš„ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šArrayListå’ŒLinkedListçš„æ•°æ®ç»“æ„](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/collection-2.png)

**ç”¨é€”æœ‰ä»€ä¹ˆä¸åŒ**ï¼š

å¤šæ•°æƒ…å†µä¸‹ï¼ŒArrayListæ›´åˆ©äºæŸ¥æ‰¾ï¼ŒLinkedListæ›´åˆ©äºåˆ å‡

- ç”±äº ArrayList æ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼Œæ‰€ä»¥ `get(int index)` å¯ä»¥ç›´æ¥é€šè¿‡æ•°ç»„ä¸‹æ ‡è·å–ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ï¼›LinkedList æ˜¯åŸºäºé“¾è¡¨å®ç°çš„ï¼Œ`get(int index)` éœ€è¦éå†é“¾è¡¨ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚

- ArrayList å¦‚æœå¢åˆ çš„æ˜¯æ•°ç»„çš„å°¾éƒ¨ï¼Œç›´æ¥æ’å…¥æˆ–è€…åˆ é™¤å°±å¯ä»¥äº†ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ï¼›å¦‚æœ add çš„æ—¶å€™æ¶‰åŠåˆ°æ‰©å®¹ï¼Œæ—¶é—´å¤æ‚åº¦ä¼šæå‡åˆ° O(n)ã€‚

  ä½†å¦‚æœæ’å…¥çš„æ˜¯ä¸­é—´çš„ä½ç½®ï¼Œå°±éœ€è¦æŠŠæ’å…¥ä½ç½®åçš„å…ƒç´ å‘å‰æˆ–è€…å‘åç§»åŠ¨ï¼Œç”šè‡³è¿˜æœ‰å¯èƒ½è§¦å‘æ‰©å®¹ï¼Œæ•ˆç‡å°±ä¼šä½å¾ˆå¤šï¼ŒO(n)ã€‚

- LinkedList å› ä¸ºæ˜¯é“¾è¡¨ç»“æ„ï¼Œæ’å…¥å’Œåˆ é™¤åªéœ€è¦æ”¹å˜å‰ç½®èŠ‚ç‚¹ã€åç½®èŠ‚ç‚¹å’Œæ’å…¥èŠ‚ç‚¹çš„å¼•ç”¨å°±è¡Œäº†ï¼Œä¸éœ€è¦ç§»åŠ¨å…ƒç´ ã€‚

  å¦‚æœæ˜¯åœ¨é“¾è¡¨çš„å¤´éƒ¨æ’å…¥æˆ–è€…åˆ é™¤ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ï¼›å¦‚æœæ˜¯åœ¨é“¾è¡¨çš„ä¸­é—´æ’å…¥æˆ–è€…åˆ é™¤ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ï¼Œå› ä¸ºéœ€è¦éå†é“¾è¡¨æ‰¾åˆ°æ’å…¥ä½ç½®ï¼›å¦‚æœæ˜¯åœ¨é“¾è¡¨çš„å°¾éƒ¨æ’å…¥æˆ–è€…åˆ é™¤ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ã€‚



æ³¨æ„ï¼š**LinkedList æ›´åˆ©äºå¢åˆ ä¸æ˜¯ä½“ç°åœ¨æ—¶é—´å¤æ‚åº¦ä¸Šï¼Œå› ä¸ºäºŒè€…å¢åˆ çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(n)**ï¼Œéƒ½éœ€è¦éå†åˆ—è¡¨ï¼›è€Œæ˜¯ä½“ç°åœ¨å¢åˆ çš„æ•ˆç‡ä¸Šï¼Œå› ä¸º LinkedList çš„å¢åˆ åªéœ€è¦æ”¹å˜å¼•ç”¨ï¼Œè€Œ ArrayList çš„å¢åˆ å¯èƒ½éœ€è¦ç§»åŠ¨å…ƒç´ ã€‚



## ArrayListå’ŒLinkedListä½¿ç”¨åœºæ™¯æœ‰ä»€ä¹ˆä¸åŒ

ArrayList é€‚ç”¨äºï¼š

- éšæœºè®¿é—®é¢‘ç¹ï¼šéœ€è¦é¢‘ç¹é€šè¿‡ç´¢å¼•è®¿é—®å…ƒç´ çš„åœºæ™¯ã€‚
- è¯»å–æ“ä½œè¿œå¤šäºå†™å…¥æ“ä½œï¼šå¦‚å­˜å‚¨ä¸ç»å¸¸æ”¹å˜çš„åˆ—è¡¨ã€‚
- æœ«å°¾æ·»åŠ å…ƒç´ ï¼šéœ€è¦é¢‘ç¹åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å…ƒç´ çš„åœºæ™¯ã€‚

LinkedList é€‚ç”¨äºï¼š

- é¢‘ç¹æ’å…¥å’Œåˆ é™¤ï¼šåœ¨åˆ—è¡¨ä¸­é—´é¢‘ç¹æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„åœºæ™¯ã€‚
- ä¸éœ€è¦å¿«é€Ÿéšæœºè®¿é—®ï¼šé¡ºåºè®¿é—®å¤šäºéšæœºè®¿é—®çš„åœºæ™¯ã€‚
- é˜Ÿåˆ—å’Œæ ˆï¼šç”±äºå…¶åŒå‘é“¾è¡¨çš„ç‰¹æ€§ï¼ŒLinkedList å¯ä»¥é«˜æ•ˆåœ°å®ç°é˜Ÿåˆ—ï¼ˆFIFOï¼‰å’Œæ ˆï¼ˆLIFOï¼‰ã€‚



## ArrayListçš„æ‰©å®¹æœºåˆ¶äº†è§£å—

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šArrayListæ‰©å®¹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/collection-5.png)

ArrayList ç¡®åˆ‡åœ°è¯´ï¼Œåº”è¯¥å«åšåŠ¨æ€æ•°ç»„ï¼Œå› ä¸ºå®ƒçš„åº•å±‚æ˜¯é€šè¿‡æ•°ç»„æ¥å®ç°çš„ï¼Œå½“å¾€ ArrayList ä¸­æ·»åŠ å…ƒç´ æ—¶ï¼Œä¼šå…ˆæ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œå¦‚æœå½“å‰å®¹é‡+1 è¶…è¿‡æ•°ç»„é•¿åº¦ï¼Œå°±ä¼šè¿›è¡Œæ‰©å®¹ã€‚

```java
private void grow(int minCapacity) {
    // overflow-conscious code
    int oldCapacity = elementData.length;
    int newCapacity = oldCapacity + (oldCapacity >> 1);
    if (newCapacity - minCapacity < 0)
        newCapacity = minCapacity;
    if (newCapacity - MAX_ARRAY_SIZE > 0)
        newCapacity = hugeCapacity(minCapacity);
    // minCapacity is usually close to size, so this is a win:
    elementData = Arrays.copyOf(elementData, newCapacity);
}
```



## ArrayListæ€ä¹ˆåºåˆ—åŒ–çš„çŸ¥é“å—ï¼Ÿä¸ºä»€ä¹ˆåº”transientä¿®é¥°æ•°ç»„

ArrayList çš„åºåˆ—åŒ–ä½¿ç”¨`transient`ä¿®é¥°å­˜å‚¨å…ƒç´ çš„`elementData`çš„æ•°ç»„ï¼Œ`transient`å…³é”®å­—çš„ä½œç”¨æ˜¯è®©è¢«ä¿®é¥°çš„æˆå‘˜å±æ€§ä¸è¢«åºåˆ—åŒ–ã€‚

**ä¸ºä»€ä¹ˆ ArrayList ä¸ç›´æ¥åºåˆ—åŒ–å…ƒç´ æ•°ç»„å‘¢ï¼Ÿ**

- å‡ºäºæ•ˆç‡çš„è€ƒè™‘ï¼Œæ•°ç»„å¯èƒ½é•¿åº¦ 100ï¼Œä½†å®é™…åªç”¨äº† 50ï¼Œå‰©ä¸‹çš„ 50 ä¸ç”¨å…¶å®ä¸ç”¨åºåˆ—åŒ–ï¼Œè¿™æ ·å¯ä»¥æé«˜åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ•ˆç‡ï¼Œè¿˜å¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´ã€‚

**é‚£ArrayListæ€ä¹ˆåºåˆ—åŒ–**

![image-20250209114002266](https://github.com/user-attachments/assets/2d02d289-fcc9-4970-8af9-c56e6063e829)


- ArrayList é€šè¿‡ä¸¤ä¸ªæ–¹æ³•**readObjectã€writeObject**è‡ªå®šä¹‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–ç­–ç•¥ï¼Œå®é™…ç›´æ¥ä½¿ç”¨ä¸¤ä¸ªæµ`ObjectOutputStream`å’Œ`ObjectInputStream`æ¥è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚



## å¿«é€Ÿå¤±è´¥(fail-fast)å’Œå®‰å…¨å¤±è´¥(fail-safe)äº†è§£å—

**å¿«é€Ÿå¤±è´¥(fail-fast)**ï¼šæ˜¯Javaé›†åˆçš„ä¸€ç§é”™è¯¯æ£€æµ‹æœºåˆ¶

- åœ¨ç”¨è¿­ä»£å™¨éå†ä¸€ä¸ªé›†åˆå¯¹è±¡æ—¶ï¼Œå¦‚æœçº¿ç¨‹ A éå†è¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹ B å¯¹é›†åˆå¯¹è±¡çš„å†…å®¹è¿›è¡Œäº†ä¿®æ”¹ï¼ˆå¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹ï¼‰ï¼Œåˆ™ä¼šæŠ›å‡º Concurrent Modification Exceptionã€‚
- åŸç†ï¼šè¿­ä»£å™¨åœ¨éå†æ—¶ç›´æ¥è®¿é—®é›†åˆä¸­çš„å†…å®¹ï¼Œå¹¶ä¸”åœ¨éå†è¿‡ç¨‹ä¸­ä½¿ç”¨ä¸€ä¸ª `modCount` å˜é‡ã€‚é›†åˆåœ¨è¢«éå†æœŸé—´å¦‚æœå†…å®¹å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šæ”¹å˜`modCount`çš„å€¼ã€‚æ¯å½“è¿­ä»£å™¨ä½¿ç”¨ hashNext()/next()éå†ä¸‹ä¸€ä¸ªå…ƒç´ ä¹‹å‰ï¼Œéƒ½ä¼šæ£€æµ‹ `modCount` å˜é‡æ˜¯å¦ä¸º `expectedmodCount` å€¼ï¼Œæ˜¯çš„è¯å°±è¿”å›éå†ï¼›å¦åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œç»ˆæ­¢éå†ã€‚

**å®‰å…¨å¤±è´¥(fail-safe)**:

- é‡‡ç”¨å®‰å…¨å¤±è´¥æœºåˆ¶çš„é›†åˆå®¹å™¨ï¼Œåœ¨éå†æ—¶ä¸æ˜¯ç›´æ¥åœ¨é›†åˆå†…å®¹ä¸Šè®¿é—®çš„ï¼Œè€Œæ˜¯**å…ˆå¤åˆ¶åŸæœ‰é›†åˆå†…å®¹ï¼Œåœ¨æ‹·è´çš„é›†åˆä¸Šè¿›è¡Œéå†**ã€‚

- ç”±äºè¿­ä»£æ—¶æ˜¯å¯¹åŸé›†åˆçš„æ‹·è´è¿›è¡Œéå†ï¼Œæ‰€ä»¥åœ¨éå†è¿‡ç¨‹ä¸­å¯¹åŸé›†åˆæ‰€ä½œçš„ä¿®æ”¹å¹¶ä¸èƒ½è¢«è¿­ä»£å™¨æ£€æµ‹åˆ°ï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘ Concurrent Modification Exceptionã€‚



## æœ‰å‡ ç§å®ç°ArrayListçº¿ç¨‹å®‰å…¨çš„æ–¹æ³•

- å¯ä»¥ä½¿ç”¨ `Collections.synchronizedList()` æ–¹æ³•ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ Listã€‚

  ```java
  SynchronizedList list = Collections.synchronizedList(new ArrayList());
  ```

  

- ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ CopyOnWriteArrayListï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œéµå¾ª**å†™æ—¶å¤åˆ¶**çš„åŸåˆ™ï¼Œæ¯å½“å¯¹åˆ—è¡¨è¿›è¡Œä¿®æ”¹ï¼ˆä¾‹å¦‚æ·»åŠ ã€åˆ é™¤æˆ–æ›´æ”¹å…ƒç´ ï¼‰æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºåˆ—è¡¨çš„ä¸€ä¸ªæ–°å‰¯æœ¬ï¼Œè¿™ä¸ªæ–°å‰¯æœ¬ä¼šæ›¿æ¢æ—§çš„åˆ—è¡¨ï¼Œè€Œå¯¹æ—§åˆ—è¡¨çš„æ‰€æœ‰è¯»å–æ“ä½œä»ç„¶å¯ä»¥ç»§ç»­ã€‚

  ```java
  CopyOnWriteArrayList list = new CopyOnWriteArrayList();
  ```



## ArrayListå’ŒVectoråŒºåˆ«

Vector å±äº JDK 1.0 æ—¶æœŸçš„é—ç•™ç±»ï¼Œå·²ä¸æ¨èä½¿ç”¨ï¼Œä»ç„¶ä¿ç•™ç€æ˜¯å› ä¸º Java å¸Œæœ›å‘åå…¼å®¹ã€‚

ArrayList æ˜¯åœ¨ JDK 1.2 æ—¶å¼•å…¥çš„ï¼Œç”¨äºæ›¿ä»£ Vector ä½œä¸ºä¸»è¦çš„éåŒæ­¥åŠ¨æ€æ•°ç»„å®ç°ã€‚å› ä¸º Vector æ‰€æœ‰çš„æ–¹æ³•éƒ½ä½¿ç”¨ synchronized å…³é”®å­—è¿›è¡Œäº†åŒæ­¥ï¼Œå•çº¿ç¨‹ç¯å¢ƒä¸‹æ•ˆç‡è¾ƒä½ã€‚



## CopyOnWriteArrayListäº†è§£å¤šå°‘

CopyOnWriteArrayList å°±æ˜¯çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬çš„ ArrayListã€‚

å®ƒçš„åå­—å«`CopyOnWrite`â€”â€”**å†™æ—¶å¤åˆ¶**ï¼Œå·²ç»æ˜ç¤ºäº†å®ƒçš„åŸç†ã€‚

![CopyOnWriteArrayListåŸç†](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/collection-7.png)

- CopyOnWriteArrayList é‡‡ç”¨äº†ä¸€ç§**è¯»å†™åˆ†ç¦»**çš„å¹¶å‘ç­–ç•¥ã€‚CopyOnWriteArrayList å®¹å™¨å…è®¸å¹¶å‘è¯»ï¼Œè¯»æ“ä½œæ˜¯æ— é”çš„ï¼Œæ€§èƒ½è¾ƒé«˜ã€‚
- è‡³äºå†™æ“ä½œï¼Œæ¯”å¦‚å‘å®¹å™¨ä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™é¦–å…ˆå°†å½“å‰å®¹å™¨å¤åˆ¶ä¸€ä»½ï¼Œç„¶ååœ¨æ–°å‰¯æœ¬ä¸Šæ‰§è¡Œå†™æ“ä½œï¼Œç»“æŸä¹‹åå†å°†åŸå®¹å™¨çš„å¼•ç”¨æŒ‡å‘æ–°å®¹å™¨ã€‚



# Map

## èƒ½è¯´ä¸€ä¸‹HashMapçš„åº•å±‚æ•°æ®ç»“æ„å—

JDK8ä¸­HashMapçš„æ•°æ®ç»“æ„æ˜¯**æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘**

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šJDK 8 HashMap æ•°æ®ç»“æ„ç¤ºæ„å›¾](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/collection-8.png)

- å½“å¤šä¸ªé”®ç»è¿‡å“ˆå¸Œå¤„ç†åå¾—åˆ°ç›¸åŒçš„ç´¢å¼•æ—¶ï¼Œéœ€è¦é€šè¿‡é“¾è¡¨æ¥è§£å†³å“ˆå¸Œå†²çªâ€”â€”å³å°†å…·æœ‰ç›¸åŒç´¢å¼•çš„é”®å€¼å¯¹é€šè¿‡é“¾è¡¨è¿æ¥èµ·æ¥

- ä¸è¿‡ï¼Œé“¾è¡¨è¿‡é•¿æ—¶ï¼ŒæŸ¥è¯¢æ•ˆç‡ä¼šæ¯”è¾ƒä½ï¼Œäºæ˜¯å½“é“¾è¡¨çš„é•¿åº¦è¶…è¿‡ 8 æ—¶ï¼ˆä¸”æ•°ç»„çš„é•¿åº¦å¤§äº 64ï¼‰ï¼Œé“¾è¡¨å°±ä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚çº¢é»‘æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ˜¯ O(logn)ï¼Œæ¯”é“¾è¡¨çš„ O(n) è¦å¿«
- HashMap çš„åˆå§‹å®¹é‡æ˜¯ 16ï¼Œéšç€å…ƒç´ çš„ä¸æ–­æ·»åŠ ï¼ŒHashMap çš„å®¹é‡å¯èƒ½ä¸è¶³ï¼Œäºæ˜¯å°±éœ€è¦è¿›è¡Œæ‰©å®¹ï¼Œé˜ˆå€¼æ˜¯`capacity * loadFactor`ï¼Œcapacity ä¸ºå®¹é‡ï¼ŒloadFactor ä¸ºè´Ÿè½½å› å­ï¼Œé»˜è®¤ä¸º 0.75
- æ‰©å®¹åçš„æ•°ç»„å¤§å°æ˜¯åŸæ¥çš„ 2 å€ï¼Œç„¶åæŠŠåŸæ¥çš„å…ƒç´ é‡æ–°è®¡ç®—å“ˆå¸Œå€¼ï¼Œæ”¾åˆ°æ–°çš„æ•°ç»„ä¸­ï¼Œè¿™ä¸€æ­¥ä¹Ÿæ˜¯**HashMap æœ€è€—æ—¶çš„æ“ä½œ**



## å¯¹çº¢é»‘æ ‘äº†è§£å¤šå°‘

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šçº¢é»‘æ ‘](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/collection-9.png)

- **å·¦æ ¹å³**ï¼šçº¢é»‘æ ‘æ˜¯ä¸€æ£µäºŒå‰æœç´¢æ ‘ï¼ˆå·¦ < æ ¹ < å³ï¼‰
- **æ ¹å¶é»‘**ï¼šæ ¹å’Œå¶å­(NULL)éƒ½æ˜¯é»‘è‰²
- **ä¸çº¢çº¢**ï¼šçº¢è‰²èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²ï¼ˆä¸å­˜åœ¨è¿ç»­çš„ä¸¤ä¸ªçº¢è‰²èŠ‚ç‚¹ï¼‰
- **é»‘è·¯åŒ**ï¼šä»»ä¸€èŠ‚ç‚¹åˆ°å¶æ‰€æœ‰è·¯å¾„é»‘è‰²èŠ‚ç‚¹æ•°é‡ç›¸åŒ
- æ’å…¥èŠ‚ç‚¹é»˜è®¤ä¸ºçº¢è‰²ï¼Œåªå¯èƒ½è¿åæ ¹å¶é»‘æˆ–è€…ä¸çº¢çº¢

è¿™äº›æ€§è´¨ä¿è¯äº†çº¢é»‘æ ‘**ä»»ä¸€èŠ‚ç‚¹å·¦å³å­æ ‘çš„é«˜åº¦å·®ä¸ä¼šè¶…è¿‡ä¸¤å€**



**çº¢é»‘æ ‘æ€ä¹ˆä¿æŒå¹³è¡¡**

- å¦‚æœæ’å…¥åæ²¡æœ‰ç ´åä¸Šé¢å››ä¸ªæ€§è´¨ï¼Œä¸ç”¨è°ƒæ•´

- æ’å…¥èŠ‚ç‚¹æ˜¯æ ¹èŠ‚ç‚¹ => ç›´æ¥å˜é»‘

- æ’å…¥èŠ‚ç‚¹çš„å”å”æ˜¯çº¢è‰² => å”çˆ¶çˆ·å˜è‰²ï¼Œçˆ·çˆ·å˜æ’å…¥èŠ‚ç‚¹æ¥ç€åˆ¤æ–­

  ![image-20250209124711316](https://github.com/user-attachments/assets/9449dcf5-84d4-4c0d-b3fd-5d609e044792)


- æ’å…¥èŠ‚ç‚¹çš„å”å”æ˜¯é»‘è‰²

  - **LLå‹**

    ![image-20250209124205439](https://github.com/user-attachments/assets/e3711ef2-88e4-4e58-971c-817f572e97a7)

![image-20250209124223068](https://github.com/user-attachments/assets/aa66f020-74c6-4e8f-8e9b-b744c91ce245)

![image-20250209124248563](https://github.com/user-attachments/assets/b2492dea-6468-4b54-b01d-1bfaffcebc30)


  - **RRå‹**

    ![image-20250209124300269](https://github.com/user-attachments/assets/9bed35f2-825a-4170-8025-2e2049728d12)

![image-20250209124314613](https://github.com/user-attachments/assets/60dd64df-fce7-46a6-a6fd-d4996b2034a9)

![image-20250209124336050](https://github.com/user-attachments/assets/4e554624-99a5-423a-b21f-bf346102d7ca)



  - **LRå‹**

    ![image-20250209124406486](https://github.com/user-attachments/assets/7d2338de-b3e9-442f-93b9-8b62c364a24e)

![image-20250209124440414](https://github.com/user-attachments/assets/4dc42c99-936b-42b7-9f90-574049b1b8a1)

![image-20250209124450097](https://github.com/user-attachments/assets/76b909b1-c1e1-4001-9c26-aa289c348026)

![image-20250209124506273](https://github.com/user-attachments/assets/ea5be996-8881-49cd-af6c-02b83b9528d2)


â€‹    

  - **RLå‹**

    ![image-20250209124532887](https://github.com/user-attachments/assets/bb34286c-4b43-4cfa-859e-1840e518d33b)

![image-20250209124548063](https://github.com/user-attachments/assets/81fc7cea-8af7-4ddd-a494-3cf4ec6feece)

![image-20250209124602507](https://github.com/user-attachments/assets/22ddcac8-1dd0-4692-86a7-010ac19983ab)

![image-20250209124613327](https://github.com/user-attachments/assets/e3d2c5d7-e5ea-4555-9f2b-7c4b55a3a3b1)


â€‹    



## ä¸ºä»€ä¹ˆä¸ç”¨äºŒå‰æ ‘/å¹³è¡¡æ ‘å‘¢

**ä¸ºä»€ä¹ˆä¸ç”¨äºŒå‰æ ‘**

- äºŒå‰æ ‘å®¹æ˜“å‡ºç°æç«¯æƒ…å†µï¼Œæ¯”å¦‚æ’å…¥çš„æ•°æ®æ˜¯æœ‰åºçš„ï¼Œé‚£ä¹ˆäºŒå‰æ ‘å°±ä¼šé€€åŒ–æˆé“¾è¡¨ï¼ŒæŸ¥è¯¢æ•ˆç‡å°±ä¼šå˜æˆ O(n)ã€‚

**ä¸ºä»€ä¹ˆä¸ç”¨å¹³è¡¡äºŒå‰æ ‘**

- å¹³è¡¡äºŒå‰æ ‘æ¯”çº¢é»‘æ ‘çš„è¦æ±‚æ›´é«˜ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å·¦å³å­æ ‘çš„é«˜åº¦æœ€å¤šç›¸å·® 1ï¼Œè¿™ç§é«˜åº¦çš„å¹³è¡¡ä¿è¯äº†æä½³çš„æŸ¥æ‰¾æ•ˆç‡ï¼Œä½†åœ¨è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œæ—¶ï¼Œå¯èƒ½éœ€è¦é¢‘ç¹åœ°è¿›è¡Œæ—‹è½¬æ¥ç»´æŒæ ‘çš„å¹³è¡¡ï¼Œç»´æŠ¤æˆæœ¬æ›´é«˜ã€‚



## HashMapçš„putæµç¨‹çŸ¥é“å—

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šHashMapæ’å…¥æ•°æ®æµç¨‹å›¾](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/collection-13.jpg)

**1. é€šè¿‡hashæ–¹æ³•è®¡ç®—keyçš„å“ˆå¸Œå€¼**

```java
static final int hash(Object key) {
    int h;
    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
}
```

**2. æ•°ç»„è¿›è¡Œç¬¬ä¸€æ¬¡æ‰©å®¹**

```java
if ((tab = table) == null || (n = tab.length) == 0)
    n = (tab = resize()).length;
```

**3. æ ¹æ®å“ˆå¸Œå€¼è®¡ç®—keyåœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ï¼Œå¦‚æœå¯¹åº”ä¸‹æ ‡æ²¡æœ‰å…ƒç´ ï¼Œç›´æ¥æ’å…¥**

```java
if ((p = tab[i = (n - 1) & hash]) == null)
    tab[i] = newNode(hash, key, value, null);
```

å¦åˆ™ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºç›¸åŒçš„keyï¼Œæ˜¯åˆ™è¦†ç›–valueã€‚ä¸æ˜¯çš„è¯éœ€è¦åˆ¤æ–­æ˜¯å¦ä¸ºæ ‘èŠ‚ç‚¹ï¼Œæ˜¯åˆ™å‘æ ‘ä¸­æ’å…¥èŠ‚ç‚¹ï¼Œå¦åˆ™å‘é“¾è¡¨ä¸­æ’å…¥æ•°æ®

```java
else {  // ğŸš€ å‘ç”Ÿå“ˆå¸Œå†²çªï¼ˆkey æ˜ å°„åˆ°å·²æœ‰çš„æ¡¶ `p`ï¼‰
    Node<K,V> e; K k;
    
    // ğŸš€ 1. æ£€æŸ¥å¤´èŠ‚ç‚¹ `p` æ˜¯å¦æ˜¯è¦æ’å…¥çš„ key
    if (p.hash == hash &&
        ((k = p.key) == key || (key != null && key.equals(k))))
        e = p; // âœ… key å·²å­˜åœ¨ï¼Œç›´æ¥è¦†ç›– value
    
    // ğŸš€ 2. å¦‚æœæ˜¯çº¢é»‘æ ‘ï¼ˆTreeNodeï¼‰ï¼Œè°ƒç”¨ `putTreeVal()` å¤„ç†
    else if (p instanceof TreeNode)
        e = ((TreeNode<K,V>)p).putTreeVal(this, tab, hash, key, value);
    
    // ğŸš€ 3. å¦åˆ™ï¼Œé‡‡ç”¨é“¾è¡¨éå†æŸ¥æ‰¾æˆ–æ’å…¥
    else {
        for (int binCount = 0; ; ++binCount) {  
            if ((e = p.next) == null) {  // ğŸš€ 3.1 éå†åˆ°é“¾è¡¨å°¾éƒ¨ï¼Œæ’å…¥æ–°èŠ‚ç‚¹
                p.next = newNode(hash, key, value, null);
                
                // ğŸš€ 3.2 å¦‚æœé“¾è¡¨é•¿åº¦ â‰¥ `TREEIFY_THRESHOLD - 1`ï¼ˆå³ >= 7ï¼‰ï¼Œè½¬æ¢ä¸ºçº¢é»‘æ ‘
                if (binCount >= TREEIFY_THRESHOLD - 1)
                    treeifyBin(tab, hash); 
                break;
            }
            
            // ğŸš€ 3.3 å¦‚æœæ‰¾åˆ°ç›¸åŒ keyï¼Œåˆ™è·³å‡ºå¾ªç¯ï¼Œåç»­è¦†ç›– value
            if (e.hash == hash &&
                ((k = e.key) == key || (key != null && key.equals(k))))
                break;
            
            p = e; // ğŸš€ ç»§ç»­éå†é“¾è¡¨
        }
    }
}
```

æ‰€æœ‰å…ƒç´ å¤„ç†å®Œåï¼Œè¿˜éœ€è¦åˆ¤æ–­æ˜¯å¦è¶…è¿‡é˜ˆå€¼`threshold`ï¼Œè¶…è¿‡åˆ™æ‰©å®¹ã€‚

```java
if (++size > threshold)
    resize();
```



## åªé‡å†™equalsæ²¡é‡å†™hashcodeï¼ŒMap putæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ

å¦‚æœåªé‡å†™ equals æ–¹æ³•ï¼Œæ²¡æœ‰é‡å†™ hashcode æ–¹æ³•ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´ equals ç›¸ç­‰çš„ä¸¤ä¸ªå¯¹è±¡ï¼Œhashcode ä¸ç›¸ç­‰ï¼Œè¿™æ ·çš„è¯ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡ä¼šè¢«æ”¾åˆ°ä¸åŒçš„æ¡¶ä¸­ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´ get çš„æ—¶å€™ï¼Œæ‰¾ä¸åˆ°å¯¹åº”çš„å€¼ã€‚

```java
public class HashMapTest {
    public static void main(String[] args) {
        Map<Person, String> map = new HashMap<>();

        Person p1 = new Person("Alice");
        Person p2 = new Person("Alice");

        map.put(p1, "Developer");
        map.put(p2, "Manager"); // ğŸš€ p2.equals(p1) ä¸º trueï¼Œä½† hashCode ä¸åŒ

        System.out.println(map.size()); // âŒ 2ï¼ˆåº”è¯¥æ˜¯ 1ï¼‰
        System.out.println(map.get(p1)); // "Developer"
        System.out.println(map.get(p2)); // "Manager"ï¼ˆä¸¤ä¸ªä¸åŒçš„ keyï¼‰
    }
}
```



## HashMapæ€ä¹ˆæŸ¥æ‰¾å…ƒç´ å‘¢

![HashMapæŸ¥æ‰¾æµç¨‹å›¾](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/collection-14.png)

HashMap çš„æŸ¥æ‰¾å°±ç®€å•å¾ˆå¤šï¼š

1. ä½¿ç”¨æ‰°åŠ¨å‡½æ•°ï¼Œè·å–æ–°çš„å“ˆå¸Œå€¼
2. è®¡ç®—æ•°ç»„ä¸‹æ ‡ï¼Œè·å–èŠ‚ç‚¹
3. å½“å‰èŠ‚ç‚¹å’Œ key åŒ¹é…ï¼Œç›´æ¥è¿”å›
4. å¦åˆ™ï¼Œå½“å‰èŠ‚ç‚¹æ˜¯å¦ä¸ºæ ‘èŠ‚ç‚¹ï¼ŒæŸ¥æ‰¾çº¢é»‘æ ‘
5. å¦åˆ™ï¼Œéå†é“¾è¡¨æŸ¥æ‰¾



## HashMapçš„hashå‡½æ•°æ˜¯æ€ä¹ˆè®¾è®¡çš„

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šhash å‡½æ•°ç¤ºæ„å›¾](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/collection-16.jpg)

HashMap çš„å“ˆå¸Œå‡½æ•°æ˜¯å…ˆæ‹¿åˆ° key çš„ hashcodeï¼Œæ˜¯ä¸€ä¸ª 32 ä½çš„ int ç±»å‹çš„æ•°å€¼ï¼Œç„¶åè®© hashcode çš„é«˜ 16 ä½å’Œä½ 16 ä½è¿›è¡Œå¼‚æˆ–æ“ä½œã€‚

**é«˜ 16 ä½ä¸å˜**

**ä½ 16 ä½ = åŸä½ 16 ä½ âŠ•ï¼ˆå¼‚æˆ–ï¼‰ é«˜ 16 ä½**

```java
static final int hash(Object key) {
    int h;
    // keyçš„hashCodeå’Œkeyçš„hashCodeå³ç§»16ä½åšå¼‚æˆ–è¿ç®—
    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
}
```

è¿™ä¹ˆè®¾è®¡æ˜¯ä¸ºäº†é™ä½å“ˆå¸Œç¢°æ’çš„æ¦‚ç‡ã€‚



## ä¸ºä»€ä¹ˆè¿™ä¸ªhashå‡½æ•°èƒ½é™ä½å“ˆå¸Œç¢°æ’

æ¯”å¦‚ä¸€å¼€å§‹HashMapçš„æ•°ç»„å¤§å°ä¸º16ï¼Œé€šè¿‡`hash & (n-1)`æ¥è®¡ç®—ä¸‹æ ‡ï¼Œ

ä½†é—®é¢˜æ˜¯hash & (2^4âˆ’1) çš„ç»“æœå®é™…ä¸Šæ˜¯å– hash çš„ä½ 4 ä½ï¼Œé‚£ä¹ˆä¸€ä¸ªå¤§çš„å“ˆå¸Œå€¼ï¼Œä¹Ÿåªå–æœ€å 4 ä½ï¼Œä¸å°±ç­‰äºå“ˆå¸Œå€¼çš„é«˜ä½éƒ½ä¸¢å¼ƒäº†å—

æ”¹è¿›åçš„å¤„ç†æ—¢è€ƒè™‘äº†é«˜ä½çš„ä¿¡æ¯ï¼Œåˆæ²¡æœ‰å®Œå…¨å¿½è§†ä½ä½åŸæœ¬çš„ä¿¡æ¯ï¼Œå°è¯•è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡çŠ¶æ€ã€‚



## ä¸ºä»€ä¹ˆHashMapçš„å®¹é‡æ˜¯2 çš„æ•´æ•°æ¬¡å¹‚å‘¢

ä¸ºäº†ä½¿ä¸¤ä¸ªè¿ç®— `hash & (length - 1)`æ›¿æ¢`hash % length` ã€‚åœ¨è®¡ç®—æœºä¸­ï¼Œä½è¿ç®—çš„é€Ÿåº¦è¦è¿œé«˜äºå–ä½™è¿ç®—ï¼Œå› ä¸ºè®¡ç®—æœºæœ¬è´¨ä¸Šå°±æ˜¯äºŒè¿›åˆ¶ã€‚



## å¦‚æœåˆå§‹åŒ–HashMapï¼Œä¼ ä¸€ä¸ª17å®¹é‡ï¼Œå®ƒä¼šæ€ä¹ˆå¤„ç†

HashMapä¼šå°†è¿™ä¸ªå€¼è½¬æ¢ä¸ºå¤§äºæˆ–ç­‰äº17çš„æœ€å°çš„2çš„å¹‚ã€‚

å› æ­¤ï¼Œå¦‚æœä¼ å…¥ 17 ä½œä¸ºåˆå§‹å®¹é‡ï¼ŒHashMap å®é™…ä¸Šä¼šè¢«åˆå§‹åŒ–ä¸ºå¤§å°ä¸º 32 çš„å“ˆå¸Œè¡¨ã€‚



åœ¨ HashMap çš„åˆå§‹åŒ–æ„é€ æ–¹æ³•ä¸­ï¼Œæœ‰è¿™æ ·â¼€æ®µä»£ç ï¼š

```java
public HashMap(int initialCapacity, float loadFactor) {
 ...
 this.loadFactor = loadFactor;
 this.threshold = tableSizeFor(initialCapacity);
}
```

é˜€å€¼ threshold ä¼šé€šè¿‡æ–¹æ³•` tableSizeFor()` è¿›è¡Œè®¡ç®—ã€‚

```java
static final int tableSizeFor(int cap) {
    int n = cap - 1;
    n |= n >>> 1;
    n |= n >>> 2;
    n |= n >>> 4;
    n |= n >>> 8;
    n |= n >>> 16;
    return (n < 0) ? 1 : (n >= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;
}
```

 n çš„æ‰€æœ‰ä½ä½éƒ½æ˜¯ 1ï¼Œæ‰€ä»¥ n + 1 å°±æ˜¯å¤§äº cap çš„æœ€å°çš„ 2 çš„å¹‚æ¬¡æ–¹ã€‚



## åˆå§‹åŒ–HashMapçš„æ—¶å€™éœ€è¦ä¼ å…¥å®¹é‡å€¼å—

åœ¨åˆ›å»º HashMap æ—¶å¯ä»¥æŒ‡å®šåˆå§‹å®¹é‡å€¼ã€‚è¿™ä¸ªå®¹é‡æ˜¯æŒ‡ Map å†…éƒ¨ç”¨äºå­˜å‚¨æ•°æ®çš„æ•°ç»„å¤§å°ã€‚

å¦‚æœé¢„å…ˆçŸ¥é“ Map å°†å­˜å‚¨å¤§é‡é”®å€¼å¯¹ï¼Œæå‰æŒ‡å®šä¸€ä¸ªè¶³å¤Ÿå¤§çš„åˆå§‹å®¹é‡å¯ä»¥**å‡å°‘å› æ‰©å®¹å¯¼è‡´çš„é‡å“ˆå¸Œï¼ˆrehashingï¼‰æ“ä½œ**ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚

å› ä¸ºæ¯æ¬¡æ‰©å®¹æ—¶ï¼ŒHashMap éœ€è¦æ–°åˆ†é…ä¸€ä¸ªæ›´å¤§çš„æ•°ç»„å¹¶é‡æ–°å°†ç°æœ‰çš„å…ƒç´ æ’å…¥åˆ°è¿™ä¸ªæ–°æ•°ç»„ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹ç›¸å¯¹è€—æ—¶ï¼Œå°¤å…¶æ˜¯å½“ Map ä¸­å·²æœ‰å¤§é‡æ•°æ®æ—¶ã€‚

å½“ç„¶äº†ï¼Œè¿‡å¤§çš„åˆå§‹å®¹é‡ä¼šæµªè´¹å†…å­˜ï¼Œç‰¹åˆ«æ˜¯å½“å®é™…å­˜å‚¨çš„å…ƒç´ è¿œå°‘äºåˆå§‹å®¹é‡æ—¶ã€‚**å¦‚æœä¸æŒ‡å®šåˆå§‹å®¹é‡ï¼ŒHashMap å°†ä½¿ç”¨é»˜è®¤çš„åˆå§‹å®¹é‡ 16**ã€‚



## è¿˜çŸ¥é“å“ªäº›å“ˆå¸Œå‡½æ•°çš„æ„é€ æ–¹æ³•

**1. é™¤ç•™å–ä½™æ³•ï¼ˆHashMapä¸­çš„æ–¹æ³•ï¼‰**

**2. ç›´æ¥å®šå€æ³•**

- ç›´æ¥æ ¹æ®`key`æ¥æ˜ å°„åˆ°å¯¹åº”çš„æ•°ç»„ä½ç½®ï¼Œä¾‹å¦‚ 1232 æ”¾åˆ°ä¸‹æ ‡ 1232 çš„ä½ç½®ã€‚

**3. æ•°å­—åˆ†ææ³•**

- å–`key`çš„æŸäº›æ•°å­—ï¼ˆä¾‹å¦‚åä½å’Œç™¾ä½ï¼‰ä½œä¸ºæ˜ å°„çš„ä½ç½®

**4. å¹³æ–¹å–ä¸­æ³•**

- å–`key`å¹³æ–¹çš„ä¸­é—´å‡ ä½ä½œä¸ºæ˜ å°„çš„ä½ç½®

**5. æŠ˜å æ³•**

- å°†`key`åˆ†å‰²æˆä½æ•°ç›¸åŒçš„å‡ æ®µï¼Œç„¶åæŠŠå®ƒä»¬çš„å åŠ å’Œä½œä¸ºæ˜ å°„çš„ä½ç½®

**6. ä¸€è‡´æ€§å“ˆå¸Œ**



## è§£å†³å“ˆå¸Œå†²çªæœ‰å“ªäº›æ–¹æ³•

**1. å†å“ˆå¸Œæ³•**

- å‡†å¤‡ä¸¤å¥—å“ˆå¸Œç®—æ³•ï¼Œå½“å‘ç”Ÿå“ˆå¸Œå†²çªçš„æ—¶å€™ï¼Œä½¿ç”¨å¦å¤–ä¸€ç§å“ˆå¸Œç®—æ³•ï¼Œç›´åˆ°æ‰¾åˆ°ç©ºæ§½ä¸ºæ­¢ã€‚å¯¹å“ˆå¸Œç®—æ³•çš„è®¾è®¡è¦æ±‚æ¯”è¾ƒé«˜ã€‚

**2. å¼€æ”¾åœ°å€æ³•**

- é‡åˆ°å“ˆå¸Œå†²çªçš„æ—¶å€™ï¼Œå°±å»å¯»æ‰¾ä¸‹ä¸€ä¸ªç©ºçš„æ§½ã€‚æœ‰ 3 ç§æ–¹æ³•ï¼š
  - çº¿æ€§æ¢æµ‹ï¼šä»å†²çªçš„ä½ç½®å¼€å§‹ï¼Œä¾æ¬¡å¾€åæ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ç©ºæ§½ã€‚
  - äºŒæ¬¡æ¢æµ‹ï¼šä»å†²çªçš„ä½ç½® x å¼€å§‹ï¼Œç¬¬ä¸€æ¬¡å¢åŠ  12 ä¸ªä½ç½®ï¼Œç¬¬äºŒæ¬¡å¢åŠ  22ï¼Œç›´åˆ°æ‰¾åˆ°ç©ºæ§½ã€‚
  - åŒé‡å“ˆå¸Œï¼šå’Œå†å“ˆå¸Œæ³•ç±»ä¼¼ï¼Œå‡†å¤‡å¤šä¸ªå“ˆå¸Œå‡½æ•°ï¼Œå‘ç”Ÿå†²çªçš„æ—¶å€™ï¼Œä½¿ç”¨å¦å¤–ä¸€ä¸ªå“ˆå¸Œå‡½æ•°ã€‚

**3. æ‹‰é“¾æ³•**

- å½“å‘ç”Ÿå“ˆå¸Œå†²çªçš„æ—¶å€™ï¼Œä½¿ç”¨é“¾è¡¨å°†å†²çªçš„å…ƒç´ ä¸²èµ·æ¥ã€‚HashMap é‡‡ç”¨çš„æ­£æ˜¯æ‹‰é“¾æ³•ã€‚



## å“ˆå¸Œè¡¨æ€ä¹ˆåˆ¤æ–­ä¸¤ä¸ªKeyæ˜¯å¦ç›¸ç­‰

ä¾èµ–äº`key`çš„`equals()`æ–¹æ³•å’Œ`hashCode()`æ–¹æ³•ï¼Œä»¥åŠ `==` è¿ç®—ç¬¦ã€‚

```java
if (e.hash == hash &&
((k = e.key) == key || (key != null && key.equals(k))))
```

- `e.hash == hash`ï¼šå…ˆæ¯”è¾ƒå“ˆå¸Œå€¼ï¼Œç¡®ä¿å¯èƒ½æ˜¯ç›¸åŒçš„é”®ã€‚

- **`k == key`**ï¼šç›´æ¥ä½¿ç”¨ `==` æ¯”è¾ƒ**å†…å­˜åœ°å€**ã€‚

- **`key.equals(k)`**ï¼šå¦‚æœ `key` ä¸æ˜¯ `null`ï¼Œå†è°ƒç”¨ `equals()` æ–¹æ³•è¿›è¡Œ**å†…å®¹æ¯”è¾ƒ**ã€‚



## ä¸ºä»€ä¹ˆHashMapé“¾è¡¨è½¬çº¢é»‘æ ‘çš„é˜ˆå€¼æ˜¯8

æ ‘åŒ–å‘ç”Ÿåœ¨ table **æ•°ç»„çš„é•¿åº¦å¤§äº 64**ï¼Œä¸”**é“¾è¡¨çš„é•¿åº¦å¤§äº 8** çš„æ—¶å€™ã€‚

çº¢é»‘æ ‘èŠ‚ç‚¹çš„å¤§å°å¤§æ¦‚æ˜¯æ™®é€šèŠ‚ç‚¹å¤§å°çš„ä¸¤å€ï¼Œæ‰€ä»¥è½¬çº¢é»‘æ ‘ï¼Œç‰ºç‰²äº†ç©ºé—´æ¢æ—¶é—´ï¼Œæ›´å¤šçš„æ˜¯ä¸€ç§å…œåº•çš„ç­–ç•¥ï¼Œä¿è¯æç«¯æƒ…å†µä¸‹çš„æŸ¥æ‰¾æ•ˆç‡ã€‚

**é˜ˆå€¼ä¸ºä»€ä¹ˆè¦é€‰ 8 å‘¢ï¼Ÿ**

å’Œç»Ÿè®¡å­¦æœ‰å…³ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œä½¿ç”¨éšæœºå“ˆå¸Œç ï¼Œé“¾è¡¨é‡Œçš„èŠ‚ç‚¹ç¬¦åˆæ³Šæ¾åˆ†å¸ƒï¼Œå‡ºç°èŠ‚ç‚¹ä¸ªæ•°çš„æ¦‚ç‡æ˜¯é€’å‡çš„ï¼ŒèŠ‚ç‚¹ä¸ªæ•°ä¸º 8 çš„æƒ…å†µï¼Œå‘ç”Ÿæ¦‚ç‡ä»…ä¸º`0.00000006`ã€‚

**çº¢é»‘æ ‘è½¬å›é“¾è¡¨çš„é˜ˆå€¼ä¸ºä»€ä¹ˆæ˜¯6ï¼Œè€Œä¸æ˜¯8ï¼Ÿ**

å¦‚æœè¿™ä¸ªé˜ˆå€¼ä¹Ÿè®¾ç½®æˆ 8ï¼Œå‡å¦‚å‘ç”Ÿç¢°æ’ï¼ŒèŠ‚ç‚¹å¢å‡åˆšå¥½åœ¨ 8 é™„è¿‘ï¼Œä¼šå‘ç”Ÿé“¾è¡¨å’Œçº¢é»‘æ ‘çš„ä¸æ–­è½¬æ¢ï¼Œå¯¼è‡´èµ„æºæµªè´¹ã€‚



## ä»€ä¹ˆæ—¶å€™æ‰©å®¹ï¼Œä¸ºä»€ä¹ˆæ‰©å®¹å› å­æ˜¯0.75ï¼Ÿ

HashMapä¼šåœ¨å­˜å‚¨çš„é”®å€¼å¯¹æ•°é‡è¶…è¿‡ **å®¹é‡ $\times$ æ‰©å®¹å› å­** æ—¶è¿›è¡Œæ‰©å®¹

**0.75æ˜¯æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´åˆ©ç”¨ç‡ä¹‹é—´çš„æƒè¡¡**

- è´Ÿè½½å› å­è¶Šå¤§
  - ç©ºé—´åˆ©ç”¨ç‡è¶Šé«˜
  - ä½†å†²çªæ¦‚ç‡å¢å¤§ï¼Œå¯¼è‡´é“¾è¡¨/çº¢é»‘æ ‘é•¿åº¦å¢é•¿ï¼ŒæŸ¥è¯¢æ•ˆç‡ä»O(1)é€€åŒ– åˆ°O(N)
- è´Ÿè½½å› å­è¶Šå°
  - å†²çªå‡å°‘ï¼ŒæŸ¥è¯¢æ›´å¿«
  - ä½†æ‰©å®¹æ›´é¢‘ç¹ï¼Œå†…å­˜æµªè´¹ä¸¥é‡



## æ‰©å®¹æœºåˆ¶äº†è§£å—

æ‰©å®¹æ—¶ï¼ŒHashMap ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œå…¶å®¹é‡æ˜¯åŸæ•°ç»„å®¹é‡çš„ä¸¤å€ã€‚ç„¶åå°†é”®å€¼å¯¹æ”¾åˆ°æ–°è®¡ç®—å‡ºçš„ç´¢å¼•ä½ç½®ä¸Šã€‚**ä¸€éƒ¨åˆ†ç´¢å¼•ä¸å˜ï¼Œå¦ä¸€éƒ¨åˆ†ç´¢å¼•ä¸ºâ€œåŸç´¢å¼•+æ—§å®¹é‡â€**ã€‚

```java
static final int hash(Object key) {
    int h;
    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
}
```

åœ¨ JDK 8 çš„æ–° hash ç®—æ³•ä¸‹ï¼Œæ•°ç»„æ‰©å®¹åçš„ç´¢å¼•ä½ç½®ï¼Œè¦ä¹ˆå°±æ˜¯åŸæ¥çš„ç´¢å¼•ä½ç½®ï¼Œè¦ä¹ˆå°±æ˜¯â€œåŸç´¢å¼•+åŸæ¥çš„å®¹é‡â€ï¼Œéµå¾ªä¸€å®šçš„è§„å¾‹ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ‰©å®¹èŠ‚ç‚¹è¿ç§»ç¤ºæ„å›¾](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/collection-27.png)

è¿™ç§è§„åˆ™**ä»…é€šè¿‡ `hash & oldCapacity` åˆ¤æ–­**ï¼Œä¸éœ€è¦é‡æ–°è®¡ç®— `hashCode()`ï¼Œæå‡æ•ˆç‡ã€‚



## æ‰©å®¹çš„æ—¶å€™æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦è¿›è¡Œä½è¿ç®—å—ï¼Œå¦‚æœè¿™ä¸ªHashMapä¸­æœ‰å‡ åä¸‡æ¡æ•°æ®ï¼Œéƒ½è¦è¿›è¡Œä½è¿ç®—å—

åœ¨ JDK 8 çš„æ–° hash ç®—æ³•ä¸‹ï¼Œæ•°ç»„æ‰©å®¹åçš„ç´¢å¼•ä½ç½®ï¼Œè¦ä¹ˆå°±æ˜¯åŸæ¥çš„ç´¢å¼•ä½ç½®ï¼Œè¦ä¹ˆå°±æ˜¯â€œåŸç´¢å¼•+åŸæ¥çš„å®¹é‡â€ï¼Œéµå¾ªä¸€å®šçš„è§„å¾‹ã€‚

å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯åˆ¤æ–­åŸå“ˆå¸Œå€¼çš„é«˜ä½ä¸­æ–°å¢çš„é‚£ä¸€ä½æ˜¯å¦ä¸º 1ï¼Œå¦‚æœæ˜¯ï¼Œè¯¥å…ƒç´ ä¼šè¢«ç§»åŠ¨åˆ°åŸä½ç½®åŠ ä¸Šæ—§å®¹é‡çš„ä½ç½®ï¼›å¦‚æœä¸æ˜¯ï¼Œåˆ™ä¿æŒåœ¨åŸä½ç½®ã€‚

**ä»…é€šè¿‡ `hash & oldCapacity` å³å¯åˆ¤æ–­**

- å½“ `hash & oldCapacity == 0`ï¼š
  - **æ–°ç´¢å¼• = æ—§ç´¢å¼•**

- å½“ `hash & oldCapacity != 0`ï¼š
  - æ–°ç´¢å¼• = æ—§ç´¢å¼• + oldCapacity

æ‰€ä»¥ï¼Œå°½ç®¡æœ‰å‡ åä¸‡æ¡æ•°æ®ï¼Œæ¯ä¸ªæ•°æ®é¡¹çš„ä½ç½®å†³å®šä»…éœ€è¦ä¸€æ¬¡ç®€å•çš„ä½è¿ç®—ã€‚ä½è¿ç®—çš„è®¡ç®—é€Ÿåº¦éå¸¸å¿«ï¼Œå› æ­¤ï¼Œå°½ç®¡æ‰©å®¹æ“ä½œæ¶‰åŠéå†æ•´ä¸ªå“ˆå¸Œè¡¨å¹¶å¯¹æ¯ä¸ªèŠ‚ç‚¹è¿›è¡Œæ“ä½œï¼Œä½†è¿™éƒ¨åˆ†æ“ä½œçš„è®¡ç®—æˆæœ¬æ˜¯ç›¸å¯¹è¾ƒä½çš„ã€‚



## JDK8å¯¹HashMapä¸»è¦åšäº†å“ªäº›ä¼˜åŒ–ï¼Ÿä¸ºä»€ä¹ˆ

**1. åº•å±‚æ•°æ®ç»“æ„ç”± æ•°ç»„ + é“¾è¡¨ æ”¹æˆäº† æ•°ç»„ + é“¾è¡¨ / çº¢é»‘æ ‘**

**2. é“¾è¡¨çš„æ’å…¥æ–¹å¼ç”± å¤´æ’æ³• æ”¹ä¸ºäº† å°¾æ’æ³•**

**3. æ‰©å®¹çš„æ—¶æœºç”± æ’å…¥æ—¶åˆ¤æ–­ æ”¹ä¸ºäº† æ’å…¥ååˆ¤æ–­**

- putVal() **å…ˆæ‰§è¡Œæ’å…¥**ï¼Œä¿è¯æ•°æ®å…ˆå­˜è¿›å»ï¼Œå³ä½¿å‘ç”Ÿæ‰©å®¹ï¼Œä¹Ÿä¸ä¼šå½±å“å½“å‰æ’å…¥æ“ä½œã€‚

**4. ä¼˜åŒ–äº†å“ˆå¸Œç®—æ³•**

- JDK7ï¼šå¤šæ¬¡ç§»ä½å’Œå¼‚æˆ–æ“ä½œ

  ![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šJDK 7 çš„ hash æ–¹æ³•](https://cdn.tobebetterjavaer.com/stutymore/collection-20240512093223.png)

- JDK8ï¼šåªè¿›è¡Œäº†ä¸€æ¬¡å¼‚æˆ–æ“ä½œï¼Œä½†ä»èƒ½æœ‰æ•ˆåœ°å‡å°‘å†²çªã€‚å¹¶ä¸”èƒ½å¤Ÿä¿è¯æ‰©å®¹åï¼Œå…ƒç´ çš„æ–°ä½ç½®è¦ä¹ˆæ˜¯åŸä½ç½®ï¼Œè¦ä¹ˆæ˜¯åŸä½ç½®åŠ ä¸Šæ—§å®¹é‡å¤§å°ã€‚

  ![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šJDK 8 çš„ hash æ–¹æ³•](https://cdn.tobebetterjavaer.com/stutymore/collection-20240512093327.png)



## ä½ èƒ½è‡ªå·±è®¾è®¡å®ç°ä¸€ä¸ªHashMapå—

```java
package caogao;

import java.util.Objects;

public class HashMap {
    public static void main(String[] args) {
        MyHashMap<Integer, Integer> hashMap = new MyHashMap<>();
        hashMap.put(1, 1);
        hashMap.put(2, 2);
        hashMap.put(3, 3);

        System.out.println(hashMap.get(1));
        System.out.println(hashMap.get(2));
        System.out.println(hashMap.get(3));
    }
}

class Node<K, V> {
    final K key;
    V value;
    Node<K, V> next;

    public Node(K key, V value){
        this.key = key;
        this.value = value;
        this.next = null;
    }
}

class MyHashMap<K, V>{
    private int capacity = 16;
    private Node<K, V>[] table;
    private int size = 0;

    public MyHashMap(){
        table = new Node[capacity];
    }

    public MyHashMap(int capacity){
        this.capacity = capacity;
        table = new Node[capacity];
    }

    // è®¡ç®—å“ˆå¸Œå€¼
    private int hash(K key){
        if(key == null){
            return 0;
        }
        int h = key.hashCode();
        return (h ^ (h >>> 16)) & (capacity - 1);
    }

    // æ’å…¥æ•°æ®
    public void put(K key, V value){
        int idx = hash(key);
        Node<K, V> newNode = new Node<>(key, value);

        if(table[idx] == null){  // tableä¸ºç©ºï¼Œç›´æ¥æ’å…¥
            table[idx] = newNode;
            size++;
        } else{ // å“ˆå¸Œå†²çªï¼Œæ‹‰é“¾æ³•
            Node<K, V> current = table[idx];
            while(current != null){
                if(Objects.equals(current.key, key)){
                    current.value = value;
                    return;
                }
                if(current.next == null){
                    current.next = newNode;
                    size++;
                    break;
                }
                current = current.next;
            }
        }

        if(size >= capacity * 0.75){
            resize();
        }
    }

    // è·å–æ•°æ®
    public V get(K key){
        int index = hash(key);
        Node<K, V> current = table[index];

        while(current != null){
            if(Objects.equals(current.key, key)){
                return current.value;
            }
            current = current.next;
        }
        return null;
    }

    // åˆ é™¤æ•°æ®
    public void remove(K key){
        int index = hash(key);
        Node<K, V> current = table[index];
        Node<K, V> prev = null;

        while(current != null){
            if(Objects.equals(current.key, key)){
                if(prev == null){
                    table[index] = current.next;
                } else{
                    prev.next = current.next;
                }
                size--;
                return;
            }
            prev = current;
            current = current.next;
        }
    }

    private void resize() {
        capacity = capacity * 2;
        Node<K, V>[] newTable = new Node[capacity];
        for (Node<K, V> node : table) {
            while (node != null) {
                int newIndex = hash(node.key);
                Node<K, V> next = node.next;

                if (newTable[newIndex] == null) {
                    newTable[newIndex] = node;
                    node.next = null;
                } else {
                    Node<K, V> temp = newTable[newIndex];
                    while (temp.next != null) {
                        temp = temp.next;
                    }
                    temp.next = node;
                    node.next = null;
                }

                node = next;
            }
        }
        table = newTable;
    }
}
```



## HashMapæ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿå¤šçº¿ç¨‹ä¸‹ä¼šæœ‰ä»€ä¹ˆé—®é¢˜

HashMapä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š

**1. å¤šçº¿ç¨‹ä¸‹æ‰©å®¹ä¼šæ­»å¾ªç¯**

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-thread-nosafe-07.png)

- JDK1.7 ä¸­çš„ HashMap ä½¿ç”¨çš„æ˜¯å¤´æ’æ³•æ’å…¥å…ƒç´ ï¼Œåœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œæ‰©å®¹çš„æ—¶å€™å°±æœ‰å¯èƒ½å¯¼è‡´å‡ºç°ç¯å½¢é“¾è¡¨ï¼Œé€ æˆæ­»å¾ªç¯ã€‚

**2. å¤šçº¿ç¨‹çš„putå¯èƒ½ä¼šå¯¼è‡´å…ƒç´ ä¸¢å¤±**

- å› ä¸ºè®¡ç®—å‡ºæ¥çš„ä½ç½®å¯èƒ½ä¼šè¢«å…¶ä»–çº¿ç¨‹çš„ put è¦†ç›–ã€‚æœ¬æ¥å“ˆå¸Œå†²çªæ˜¯åº”è¯¥ç”¨é“¾è¡¨çš„ï¼Œä½†å¤šçº¿ç¨‹æ—¶ç”±äºæ²¡æœ‰åŠ é”ï¼Œç›¸åŒä½ç½®çš„å…ƒç´ å¯èƒ½å°±è¢«å¹²æ‰äº†ã€‚

**3. putå’Œgetå¹¶å‘æ—¶ï¼Œå¯èƒ½å¯¼è‡´getä¸ºnull**



## æœ‰ä»€ä¹ˆåŠæ³•èƒ½è§£å†³HashMapçº¿ç¨‹ä¸å®‰å…¨é—®é¢˜å‘¢

**1. Hashtable**

- Hashtable æ˜¯ Map æ¥å£çš„ä¸€ä¸ªæ—©æœŸçš„åŒæ­¥å®ç°ï¼Œå®ƒçš„**æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯åŒæ­¥çš„**ï¼Œå³æ¯ä¸ªæ–¹æ³•éƒ½ç”¨ synchronized å…³é”®å­—ä¿®é¥°ï¼Œä»¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚

**2. Collection.synchronizedMap**

å†…éƒ¨æ˜¯é€šè¿‡ synchronized å¯¹è±¡é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨çš„ã€‚

**3. ConcurrentHashMap**

ConcurrentHashMap åœ¨ JDK 7 ä¸­ä½¿ç”¨äº†**åˆ†æ®µé”**æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œåœ¨ JDK 8 ä¸­ä½¿ç”¨äº†**CAS + synchronized** å…³é”®å­—ã€‚



## HashMapå†…éƒ¨èŠ‚ç‚¹æ˜¯æœ‰åºçš„å—

HashMap æ˜¯æ— åºçš„ï¼Œæ ¹æ® hash å€¼éšæœºæ’å…¥ã€‚å¦‚æœæƒ³ä½¿ç”¨æœ‰åºçš„ Mapï¼Œå¯ä»¥ä½¿ç”¨ LinkedHashMap æˆ–è€… TreeMapã€‚



## HashMapæ˜¯å¦å¯ä»¥å­˜ç©ºå€¼

HashMapå…è®¸nullä½œä¸ºkeyï¼Œä½†åªèƒ½æœ‰ä¸€ä¸ª

HashMapå…è®¸nullä½œä¸ºvalueï¼Œæ²¡æœ‰æ•°é‡é™åˆ¶



Hashtable ä¸å…è®¸nullkeyæˆ– null` `valueï¼Œå¦åˆ™æŠ› NullPointerException



## LinkedHashMapæ€ä¹ˆå®ç°æœ‰åºçš„

LinkedHashMap ç»´æŠ¤äº† **æ•°ç»„ + åŒå‘é“¾è¡¨**ï¼Œæ¯ä¸ªNodeæœ‰å¤´å°¾èŠ‚ç‚¹ï¼ŒåŒæ—¶ LinkedHashMap èŠ‚ç‚¹ Entry å†…éƒ¨é™¤äº†ç»§æ‰¿ HashMap çš„ Node å±æ€§ï¼Œè¿˜æœ‰ before å’Œ after ç”¨äºæ ‡è¯†å‰ç½®èŠ‚ç‚¹å’Œåç½®èŠ‚ç‚¹ã€‚

![EntryèŠ‚ç‚¹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/collection-33.png)

![LinkedHashMapå®ç°åŸç†](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/collection-34.png)



## TreeMapæ€ä¹ˆå®ç°çš„æœ‰åº

TreeMap é€šè¿‡ key çš„æ¯”è¾ƒå™¨æ¥å†³å®šå…ƒç´ çš„é¡ºåºï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šæ¯”è¾ƒå™¨ï¼Œé‚£ä¹ˆ key å¿…é¡»å®ç°Comparable æ¥å£ã€‚

TreeMap çš„åº•å±‚æ˜¯**çº¢é»‘æ ‘**ï¼Œçº¢é»‘æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¤§äºå…¶å·¦å­æ ‘ä¸­çš„ä»»ä½•èŠ‚ç‚¹ï¼Œå°äºå…¶å³å­èŠ‚ç‚¹æ ‘ç§çš„ä»»ä½•èŠ‚ç‚¹ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šTreeMap](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/collection-35.png)

æ’å…¥æˆ–è€…åˆ é™¤å…ƒç´ æ—¶é€šè¿‡æ—‹è½¬å’Œç€è‰²æ¥ä¿æŒæ ‘çš„å¹³è¡¡ã€‚



## TreeMapå’ŒHashMapçš„åŒºåˆ«

â‘ ã€HashMap æ˜¯åŸºäºæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘å®ç°çš„ï¼Œput å…ƒç´ çš„æ—¶å€™ä¼šå…ˆè®¡ç®— key çš„å“ˆå¸Œå€¼ï¼Œç„¶åé€šè¿‡å“ˆå¸Œå€¼è®¡ç®—å‡ºå…ƒç´ åœ¨æ•°ç»„ä¸­çš„å­˜æ”¾ä¸‹æ ‡ï¼Œç„¶åå°†å…ƒç´ æ’å…¥åˆ°æŒ‡å®šçš„ä½ç½®ï¼Œå¦‚æœå‘ç”Ÿå“ˆå¸Œå†²çªï¼Œä¼šä½¿ç”¨é“¾è¡¨æ¥è§£å†³ï¼Œå¦‚æœé“¾è¡¨é•¿åº¦å¤§äº 8ï¼Œä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚

â‘¡ã€TreeMap æ˜¯åŸºäºçº¢é»‘æ ‘å®ç°çš„ï¼Œput å…ƒç´ çš„æ—¶å€™ä¼šå…ˆåˆ¤æ–­æ ¹èŠ‚ç‚¹æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºï¼Œç›´æ¥æ’å…¥åˆ°æ ¹èŠ‚ç‚¹ï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œä¼šé€šè¿‡ key çš„æ¯”è¾ƒå™¨æ¥åˆ¤æ–­å…ƒç´ åº”è¯¥æ’å…¥åˆ°å·¦å­æ ‘è¿˜æ˜¯å³å­æ ‘ã€‚

- åœ¨æ²¡æœ‰å‘ç”Ÿå“ˆå¸Œå†²çªçš„æƒ…å†µä¸‹ï¼ŒHashMap çš„æŸ¥æ‰¾æ•ˆç‡æ˜¯ `O(1)`ã€‚é€‚ç”¨äºæŸ¥æ‰¾æ“ä½œæ¯”è¾ƒé¢‘ç¹çš„åœºæ™¯ã€‚

- TreeMap çš„æŸ¥æ‰¾æ•ˆç‡æ˜¯ `O(logn)`ã€‚å¹¶ä¸”ä¿è¯äº†å…ƒç´ çš„é¡ºåºï¼Œå› æ­¤é€‚ç”¨äºéœ€è¦å¤§é‡èŒƒå›´æŸ¥æ‰¾æˆ–è€…æœ‰åºéå†çš„åœºæ™¯ã€‚





# Set

## HashSetçš„åº•å±‚å®ç°

HashSet å…¶å®æ˜¯ç”± HashMap å®ç°çš„ï¼Œåªä¸è¿‡å€¼ç”±ä¸€ä¸ªå›ºå®šçš„ Object å¯¹è±¡å¡«å……ï¼Œè€Œé”®ç”¨äºæ“ä½œã€‚

```java
public class HashSet<E>
    extends AbstractSet<E>
    implements Set<E>, Cloneable, java.io.Serializable
{
    static final long serialVersionUID = -5024744406713321676L;
    private transient HashMap<E,Object> map;
    // Dummy value to associate with an Object in the backing Map
    private static final Object PRESENT = new Object();
    // â€¦â€¦
}
```

